<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SparrowRecSys 大规模数据集扩展与智能海报系统实验手册</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            border-left: 4px solid #3498db;
            padding-left: 10px;
            margin-top: 30px;
        }
        h3 {
            color: #2c3e50;
            margin-top: 25px;
        }
        .highlight-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .stats-table th,
        .stats-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .stats-table th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        .stats-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .code-block {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }
        .success-indicator {
            color: #27ae60;
            font-weight: bold;
        }
        .warning-indicator {
            color: #e74c3c;
            font-weight: bold;
        }
        .info-box {
            background-color: #ebf3fd;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 15px 0;
        }
        .checklist {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .checklist ul {
            list-style-type: none;
            padding: 0;
        }
        .checklist li {
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }
        .checklist li:before {
            content: "☐ ";
            color: #3498db;
            font-weight: bold;
            margin-right: 10px;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .feature-card h4 {
            color: #3498db;
            margin-top: 0;
        }
        .progress-bar {
            background-color: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            background: linear-gradient(90deg, #3498db, #2ecc71);
            height: 20px;
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        .emoji {
            font-size: 1.2em;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 SparrowRecSys 大规模数据集扩展与智能海报系统实验手册</h1>
        
        <div class="highlight-box">
            <h2><span class="emoji">📚</span>实验概述</h2>
            <p>本实验将SparrowRecSys推荐系统从1,000部电影扩展到24,010部电影，并实现了智能海报显示系统。通过MovieLens 25M数据集的集成，系统性能和用户体验得到显著提升。</p>
        </div>

        <h2><span class="emoji">🎯</span>实验目标</h2>
        <div class="feature-grid">
            <div class="feature-card">
                <h4>数据规模扩展</h4>
                <p>将电影数据库从1K扩展到24K规模（2400%增长）</p>
            </div>
            <div class="feature-card">
                <h4>模型重训练</h4>
                <p>重新训练embedding模型以适应大规模数据</p>
            </div>
            <div class="feature-card">
                <h4>智能海报系统</h4>
                <p>实现基于电影标题的动态海报生成系统</p>
            </div>
            <div class="feature-card">
                <h4>用户体验提升</h4>
                <p>解决大规模数据集带来的海报覆盖问题</p>
            </div>
        </div>

        <h2><span class="emoji">📊</span>数据规模对比</h2>
        <table class="stats-table">
            <thead>
                <tr>
                    <th>项目</th>
                    <th>扩展前</th>
                    <th>扩展后</th>
                    <th>增长比例</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>电影数量</td>
                    <td>1,000</td>
                    <td>24,010</td>
                    <td class="success-indicator">2,401%</td>
                </tr>
                <tr>
                    <td>评分记录</td>
                    <td>100,836</td>
                    <td>24,802,924</td>
                    <td class="success-indicator">24,608%</td>
                </tr>
                <tr>
                    <td>用户数量</td>
                    <td>610</td>
                    <td>162,541</td>
                    <td class="success-indicator">26,653%</td>
                </tr>
                <tr>
                    <td>嵌入向量</td>
                    <td>944</td>
                    <td>17,673</td>
                    <td class="success-indicator">1,872%</td>
                </tr>
            </tbody>
        </table>

        <h2><span class="emoji">🛠️</span>技术栈</h2>
        <ul>
            <li><strong>数据处理</strong>: Python 3, pandas, numpy</li>
            <li><strong>机器学习</strong>: gensim (Word2Vec), scikit-learn</li>
            <li><strong>后端</strong>: Java 8+, Maven, Jetty</li>
            <li><strong>前端</strong>: JavaScript, HTML5, SVG动态生成</li>
            <li><strong>数据集</strong>: MovieLens 25M (25,000,095条评分)</li>
        </ul>

        <h2><span class="emoji">📥</span>第一部分：大规模数据集准备</h2>
        
        <h3>1.1 MovieLens 25M数据集下载</h3>
        <div class="code-block">
# 创建数据目录
mkdir -p python_embedding/ml-25m-data
cd python_embedding

# 下载MovieLens 25M数据集 (265MB)
wget https://files.grouplens.org/datasets/movielens/ml-25m.zip
unzip ml-25m.zip

# 验证数据规模
echo "=== MovieLens 25M 数据集统计 ==="
wc -l ml-25m/ratings.csv
wc -l ml-25m/movies.csv
wc -l ml-25m/links.csv
head -5 ml-25m/movies.csv
        </div>

        <div class="info-box">
            <strong>预期输出：</strong>
            <div class="code-block">
=== MovieLens 25M 数据集统计 ===
25000096 ml-25m/ratings.csv    # 2500万条评分
62424 ml-25m/movies.csv        # 6.2万部电影
62424 ml-25m/links.csv         # 外部链接数据
movieId,title,genres
1,Toy Story (1995),Adventure|Animation|Children|Comedy|Fantasy
2,Jumanji (1995),Adventure|Children|Fantasy
            </div>
        </div>

        <h2><span class="emoji">🔄</span>第二部分：数据转换与筛选</h2>
        
        <h3>2.1 数据格式转换脚本</h3>
        <p>创建 <code>convert_ml25m_to_sparrow.py</code> 脚本，执行智能数据筛选和格式转换：</p>
        
        <div class="info-box">
            <strong>关键功能：</strong>
            <ul>
                <li>筛选高质量电影（至少100次评分）</li>
                <li>重新映射ID（从1开始连续）</li>
                <li>转换为SparrowRecSys格式</li>
                <li>生成转换报告</li>
            </ul>
        </div>

        <div class="code-block">
# 运行数据转换
python convert_ml25m_to_sparrow.py

# 查看转换结果
ls -la sparrow_data/
head sparrow_data/movies.csv
        </div>

        <h2><span class="emoji">🧠</span>第三部分：嵌入模型重训练</h2>
        
        <h3>3.1 大规模嵌入训练</h3>
        <p>使用 <code>large_scale_embedding_trainer.py</code> 训练新的item2vec模型：</p>

        <div class="feature-grid">
            <div class="feature-card">
                <h4>训练参数</h4>
                <ul>
                    <li>向量维度: 100</li>
                    <li>窗口大小: 5</li>
                    <li>最小频次: 5</li>
                    <li>训练轮次: 20</li>
                </ul>
            </div>
            <div class="feature-card">
                <h4>优化策略</h4>
                <ul>
                    <li>Skip-gram算法</li>
                    <li>负采样优化</li>
                    <li>多线程并行</li>
                    <li>高质量序列</li>
                </ul>
            </div>
        </div>

        <div class="code-block">
# 安装依赖
pip install gensim pandas numpy scikit-learn

# 运行嵌入训练（需要10-20分钟）
python large_scale_embedding_trainer.py

# 查看训练结果
ls -la embeddings/
head embeddings/item2vecEmb.csv
wc -l embeddings/*.csv
        </div>

        <h2><span class="emoji">🔧</span>第四部分：系统数据更新</h2>
        
        <h3>4.1 替换系统数据文件</h3>
        <div class="code-block">
# 备份原始数据
cd SparrowRecSys
cp -r src/main/resources/webroot/sampledata/ backup_original_data/
cp -r src/main/resources/webroot/modeldata/ backup_original_models/

# 复制新的数据文件
cp python_embedding/sparrow_data/movies.csv src/main/resources/webroot/sampledata/
cp python_embedding/sparrow_data/ratings.csv src/main/resources/webroot/sampledata/
cp python_embedding/sparrow_data/links.csv src/main/resources/webroot/sampledata/

# 复制新的模型文件
cp python_embedding/embeddings/item2vecEmb.csv src/main/resources/webroot/modeldata/
cp python_embedding/embeddings/userEmb.csv src/main/resources/webroot/modeldata/
        </div>

        <h3>4.2 编译并启动系统</h3>
        <div class="code-block">
# 编译项目
mvn compile

# 启动推荐服务器
mvn exec:java -Dexec.mainClass="com.sparrowrecsys.online.RecSysServer"
        </div>

        <div class="info-box">
            <strong>系统启动日志示例：</strong>
            <div class="code-block">
Loading movie data from .../sampledata/movies.csv ...
Loading movie data completed. 24010 movies in total.
Loading rating data from .../sampledata/ratings.csv ...
Loading rating data completed. 24802924 ratings in total.
Loading item2vec model...
Item2vec Embedding size: 17673
Loading user embedding...
User Embedding size: 1000
RecSys server started at http://localhost:6010
            </div>
        </div>

        <h2><span class="emoji">🎨</span>第五部分：智能海报系统设计</h2>
        
        <h3>5.1 问题分析</h3>
        <div class="info-box">
            <strong>扩展到24K电影后发现的问题：</strong>
            <ul>
                <li>原系统只有1-1000的本地海报文件</li>
                <li>新增的23K电影（ID > 1000）没有海报显示</li>
                <li>TMDB API需要密钥且不稳定</li>
            </ul>
        </div>

        <h3>5.2 动态海报生成解决方案</h3>
        <div class="feature-grid">
            <div class="feature-card">
                <h4>🎨 智能颜色主题</h4>
                <p>17种电影类型的专属颜色，视觉识别度高</p>
            </div>
            <div class="feature-card">
                <h4>📝 智能文本布局</h4>
                <p>自动分行显示长标题，保持美观</p>
            </div>
            <div class="feature-card">
                <h4>🖼️ SVG矢量图形</h4>
                <p>高清显示，适配任意分辨率</p>
            </div>
            <div class="feature-card">
                <h4>🔄 多层级回退</h4>
                <p>本地→动态→默认的三级错误处理</p>
            </div>
        </div>

        <h3>5.3 类型颜色映射表</h3>
        <table class="stats-table">
            <thead>
                <tr>
                    <th>电影类型</th>
                    <th>颜色</th>
                    <th>十六进制</th>
                    <th>设计理念</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Action (动作)</td>
                    <td style="background-color: #e74c3c; color: white;">红色</td>
                    <td>#e74c3c</td>
                    <td>激情、刺激</td>
                </tr>
                <tr>
                    <td>Comedy (喜剧)</td>
                    <td style="background-color: #f1c40f; color: black;">黄色</td>
                    <td>#f1c40f</td>
                    <td>欢乐、明亮</td>
                </tr>
                <tr>
                    <td>Drama (剧情)</td>
                    <td style="background-color: #2c3e50; color: white;">深蓝</td>
                    <td>#2c3e50</td>
                    <td>深沉、严肃</td>
                </tr>
                <tr>
                    <td>Sci-Fi (科幻)</td>
                    <td style="background-color: #3498db; color: white;">蓝色</td>
                    <td>#3498db</td>
                    <td>科技、未来</td>
                </tr>
                <tr>
                    <td>Horror (恐怖)</td>
                    <td style="background-color: #c0392b; color: white;">暗红</td>
                    <td>#c0392b</td>
                    <td>恐惧、神秘</td>
                </tr>
                <tr>
                    <td>Romance (爱情)</td>
                    <td style="background-color: #e91e63; color: white;">粉色</td>
                    <td>#e91e63</td>
                    <td>浪漫、温馨</td>
                </tr>
            </tbody>
        </table>

        <h2><span class="emoji">🧪</span>第六部分：系统测试与验证</h2>
        
        <h3>6.1 功能测试</h3>
        <div class="code-block">
# 测试API响应
curl "http://localhost:6010/getrecforyou?id=1&size=10&model=emb" | head -20

# 检查新电影数据
curl "http://localhost:6010/getmoviebymovie?id=5000" | jq '.'

# 验证大ID电影
curl "http://localhost:6010/getmoviebymovie?id=20000" | jq '.'
        </div>

        <h3>6.2 海报显示测试</h3>
        <p>创建测试页面验证不同范围电影ID的海报显示效果：</p>
        <div class="info-box">
            <strong>测试范围：</strong>
            <ul>
                <li>ID 1-1000: 本地海报文件</li>
                <li>ID 1001-24000: 动态生成海报</li>
                <li>无效ID: 默认海报显示</li>
            </ul>
        </div>

        <h2><span class="emoji">📈</span>第七部分：实验总结与扩展</h2>
        
        <h3>7.1 实验成果总结</h3>
        <div class="progress-bar">
            <div class="progress-fill" style="width: 100%;"></div>
        </div>
        <p style="text-align: center; margin-top: 10px;"><strong>项目完成度: 100%</strong></p>

        <table class="stats-table">
            <thead>
                <tr>
                    <th>指标</th>
                    <th>扩展前</th>
                    <th>扩展后</th>
                    <th>提升</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>电影数量</td>
                    <td>1,000</td>
                    <td>24,010</td>
                    <td class="success-indicator">2,401%</td>
                </tr>
                <tr>
                    <td>评分记录</td>
                    <td>100K</td>
                    <td>24.8M</td>
                    <td class="success-indicator">24,800%</td>
                </tr>
                <tr>
                    <td>用户数量</td>
                    <td>610</td>
                    <td>162K</td>
                    <td class="success-indicator">26,656%</td>
                </tr>
                <tr>
                    <td>嵌入向量</td>
                    <td>944</td>
                    <td>17,673</td>
                    <td class="success-indicator">1,872%</td>
                </tr>
                <tr>
                    <td>海报覆盖</td>
                    <td>100%</td>
                    <td>100%</td>
                    <td class="success-indicator">维持</td>
                </tr>
            </tbody>
        </table>

        <h3>7.2 技术创新点</h3>
        <div class="feature-grid">
            <div class="feature-card">
                <h4>🔍 智能数据筛选</h4>
                <p>通过评分次数筛选高质量电影，确保数据质量</p>
            </div>
            <div class="feature-card">
                <h4>🎨 动态海报生成</h4>
                <p>基于电影标题和类型的SVG海报，零网络依赖</p>
            </div>
            <div class="feature-card">
                <h4>🌈 类型色彩主题</h4>
                <p>17种电影类型的专属颜色，提升视觉识别度</p>
            </div>
            <div class="feature-card">
                <h4>🔄 分层错误处理</h4>
                <p>本地→动态→默认的三级回退机制</p>
            </div>
        </div>

        <h2><span class="emoji">🎯</span>实验检查清单</h2>
        <div class="checklist">
            <h3><span class="emoji">✅</span>数据扩展 (40分)</h3>
            <ul>
                <li>下载MovieLens 25M数据集</li>
                <li>运行数据转换脚本</li>
                <li>验证数据质量（24K电影，24M评分）</li>
                <li>替换系统数据文件</li>
            </ul>

            <h3><span class="emoji">✅</span>模型训练 (30分)</h3>
            <ul>
                <li>安装Python依赖（gensim, pandas）</li>
                <li>运行大规模嵌入训练</li>
                <li>验证模型输出（17K向量）</li>
                <li>集成到推荐系统</li>
            </ul>

            <h3><span class="emoji">✅</span>海报系统 (20分)</h3>
            <ul>
                <li>生成动态海报映射</li>
                <li>修改前端JavaScript代码</li>
                <li>测试海报显示效果</li>
                <li>验证错误处理机制</li>
            </ul>

            <h3><span class="emoji">✅</span>系统集成 (10分)</h3>
            <ul>
                <li>编译并启动系统</li>
                <li>测试API响应</li>
                <li>验证推荐功能</li>
                <li>检查用户界面</li>
            </ul>
        </div>

        <h2><span class="emoji">💡</span>常见问题解答</h2>
        
        <div class="info-box">
            <h4><span class="emoji">❓</span>Q1: 数据转换时内存不足</h4>
            <p><strong>A:</strong> 调整Python脚本的batch_size，或增加虚拟内存。可以通过分批处理大文件来解决。</p>
        </div>

        <div class="info-box">
            <h4><span class="emoji">❓</span>Q2: 嵌入训练时间过长</h4>
            <p><strong>A:</strong> 调整训练参数，增加并行度。可以增加workers数量、减少迭代次数或提高最小频次。</p>
        </div>

        <div class="info-box">
            <h4><span class="emoji">❓</span>Q3: 海报显示异常</h4>
            <p><strong>A:</strong> 检查JavaScript控制台错误，验证文件路径。可以在浏览器开发者工具中调试海报生成过程。</p>
        </div>

        <div class="info-box">
            <h4><span class="emoji">❓</span>Q4: 服务器启动失败</h4>
            <p><strong>A:</strong> 检查端口占用和内存分配。可以使用 <code>lsof -i :6010</code> 检查端口，并增加Maven内存设置。</p>
        </div>

        <h2><span class="emoji">📚</span>参考资料</h2>
        <ul>
            <li><strong>MovieLens 25M Dataset</strong>: <a href="https://grouplens.org/datasets/movielens/25m/">https://grouplens.org/datasets/movielens/25m/</a></li>
            <li><strong>Gensim Word2Vec</strong>: <a href="https://radimrehurek.com/gensim/models/word2vec.html">https://radimrehurek.com/gensim/models/word2vec.html</a></li>
            <li><strong>SVG动态生成</strong>: <a href="https://developer.mozilla.org/docs/Web/SVG">https://developer.mozilla.org/docs/Web/SVG</a></li>
            <li><strong>推荐系统算法</strong>: <em>Recommender Systems Handbook</em></li>
            <li><strong>大规模机器学习</strong>: <em>Scaling Up Machine Learning</em></li>
        </ul>

        <div class="highlight-box" style="text-align: center; margin-top: 40px;">
            <h3><span class="emoji">🎉</span>恭喜完成实验！</h3>
            <p>您已经成功将SparrowRecSys推荐系统扩展到大规模数据集，并实现了智能海报显示系统。</p>
            <p>系统现在支持24,010部电影的推荐，覆盖了更广泛的用户偏好和内容类型。</p>
            <p><strong>实验手册版本: 1.0 | 更新时间: 2025年9月20日</strong></p>
        </div>
    </div>

    <script>
        // 添加交互效果
        document.addEventListener('DOMContentLoaded', function() {
            // 为代码块添加复制功能
            const codeBlocks = document.querySelectorAll('.code-block');
            codeBlocks.forEach(block => {
                block.addEventListener('click', function() {
                    navigator.clipboard.writeText(this.textContent).then(() => {
                        this.style.backgroundColor = '#27ae60';
                        setTimeout(() => {
                            this.style.backgroundColor = '#2c3e50';
                        }, 1000);
                    });
                });
            });

            // 进度条动画
            const progressBars = document.querySelectorAll('.progress-fill');
            progressBars.forEach(bar => {
                const width = bar.style.width;
                bar.style.width = '0%';
                setTimeout(() => {
                    bar.style.width = width;
                }, 500);
            });
        });
    </script>
</body>
</html>