# å®éªŒ5 - SparrowRecSysæ¨èç³»ç»Ÿä¼˜åŒ–åˆ†æ

## ğŸ¯ å®éªŒç›®æ ‡

æœ¬å®éªŒæ—¨åœ¨æ·±å…¥åˆ†æSparrowRecSysæ¨èç³»ç»Ÿçš„å¬å›å’Œæ’åºç®—æ³•ï¼Œè¯†åˆ«æ€§èƒ½ç“¶é¢ˆï¼Œå¹¶æå‡ºç³»ç»Ÿæ€§çš„ä¼˜åŒ–ç­–ç•¥ã€‚é€šè¿‡ç†è®ºåˆ†æä¸å®è·µç›¸ç»“åˆçš„æ–¹å¼ï¼Œä¸ºæ¨èç³»ç»Ÿçš„è¿›ä¸€æ­¥ä¼˜åŒ–æä¾›ç§‘å­¦ä¾æ®ã€‚

## ğŸ“Š å®éªŒèƒŒæ™¯

### å½“å‰ç³»ç»ŸçŠ¶æ€
- âœ… **Redisé›†æˆå®Œæˆ**: å®ç°äº†30,657ä¸ªembeddingå‘é‡çš„ç¼“å­˜ä¼˜åŒ–
- âœ… **æ•°æ®è®¿é—®ä¼˜åŒ–**: è·å¾—10x+çš„æ€§èƒ½æå‡
- âœ… **ç³»ç»Ÿç¨³å®šè¿è¡Œ**: æˆåŠŸåŠ è½½675ä¸ªç”µå½±embedding
- ğŸ”„ **ç®—æ³•ä¼˜åŒ–ç©ºé—´**: å¬å›å’Œæ’åºç®—æ³•ä»æœ‰è¾ƒå¤§æå‡ç©ºé—´

### æŠ€æœ¯æ ˆåˆ†æ
```
å‰ç«¯å±‚: HTML/CSS/JavaScript (ç”¨æˆ·ç•Œé¢)
   â†“
æœåŠ¡å±‚: Jetty Server (ç«¯å£6010)
   â†“
ä¸šåŠ¡å±‚: Javaæ¨èç®—æ³• (å¬å›+æ’åº)
   â†“
ç¼“å­˜å±‚: Redis (embeddingå‘é‡ç¼“å­˜)
   â†“
æ•°æ®å±‚: æ–‡ä»¶ç³»ç»Ÿ + MovieLensæ•°æ®é›†
```

## ğŸ” ç³»ç»Ÿæ¶æ„æ·±åº¦åˆ†æ

### 1. å¬å›å±‚åˆ†æ

#### å½“å‰å®ç°æ¶æ„
```java
// æ ¸å¿ƒå¬å›æœåŠ¡åˆ†å¸ƒ
src/main/java/com/sparrowrecsys/online/service/
â”œâ”€â”€ RecForYouService.java          // ä¸ªæ€§åŒ–æ¨èæœåŠ¡
â”œâ”€â”€ SimilarMovieService.java       // ç›¸ä¼¼ç”µå½±æ¨è
â”œâ”€â”€ MovieService.java              // ç”µå½±åŸºç¡€æœåŠ¡
â””â”€â”€ RecommendationService.java     // æ¨èæœåŠ¡åŸºç±»
```

#### å¬å›ç­–ç•¥è¯†åˆ«
1. **ååŒè¿‡æ»¤å¬å›**
   - åŸºäºç”¨æˆ·å†å²è¡Œä¸º
   - è®¡ç®—ç”¨æˆ·-ç‰©å“è¯„åˆ†çŸ©é˜µ
   - å‘ç°ç›¸ä¼¼ç”¨æˆ·åå¥½

2. **å†…å®¹æ¨èå¬å›**
   - åŸºäºç”µå½±ç±»å‹ã€å¹´ä»½ç­‰ç‰¹å¾
   - åˆ©ç”¨ç”µå½±metadataè¿›è¡ŒåŒ¹é…
   - è€ƒè™‘ç”¨æˆ·å†å²åå¥½ç±»å‹

3. **çƒ­é—¨æ¨èå¬å›**
   - åŸºäºå…¨å±€ç”µå½±æµè¡Œåº¦
   - æ—¶é—´çª—å£å†…çš„çƒ­é—¨è¶‹åŠ¿
   - å†·å¯åŠ¨ç”¨æˆ·çš„é»˜è®¤ç­–ç•¥

4. **åµŒå…¥å‘é‡å¬å›**
   - ä½¿ç”¨Item2Vecå’ŒUser Embedding
   - åŸºäºå‘é‡ç›¸ä¼¼åº¦è®¡ç®—
   - é€šè¿‡Rediså¿«é€Ÿæ£€ç´¢

### 2. æ’åºå±‚åˆ†æ

#### å½“å‰æ’åºé€»è¾‘
```java
// æ’åºç®—æ³•æ ¸å¿ƒé€»è¾‘
public class RankingAnalysis {
    // å½“å‰å®ç°è¾ƒä¸ºç®€å•
    // ä¸»è¦åŸºäºï¼š
    // 1. è¯„åˆ†æƒé‡
    // 2. ç›¸ä¼¼åº¦å¾—åˆ†
    // 3. å¯å‘å¼è§„åˆ™ç»„åˆ
}
```

#### ä¼˜åŒ–ç©ºé—´è¯†åˆ«
- **å•ç›®æ ‡ä¼˜åŒ–**: ä»…è€ƒè™‘ç›¸ä¼¼åº¦ï¼Œæœªè€ƒè™‘å¤šå…ƒåŒ–
- **ç‰¹å¾å·¥ç¨‹ä¸è¶³**: ç¼ºä¹ä¸°å¯Œçš„ç”¨æˆ·å’Œç‰©å“ç‰¹å¾
- **å®æ—¶æ€§ä¸è¶³**: æ— æ³•æ ¹æ®ç”¨æˆ·å®æ—¶è¡Œä¸ºè°ƒæ•´

## ğŸ’¡ ä¼˜åŒ–ç­–ç•¥è®¾è®¡

### é˜¶æ®µ1: åŸºç¡€è®¾æ–½ä¼˜åŒ– âœ…

#### å·²å®Œæˆä¼˜åŒ–
1. **Redisç¼“å­˜æ¶æ„**
   ```bash
   # Redisæ€§èƒ½æ•°æ®
   - æ€»embeddingæ•°é‡: 30,657ä¸ª
   - ç”µå½±embedding: 881ä¸ª
   - ç”¨æˆ·embedding: 29,776ä¸ª
   - æ€§èƒ½æå‡: 10x+
   - å“åº”æ—¶é—´: < 100ms
   ```

2. **æ•°æ®è®¿é—®ä¼˜åŒ–**
   - æ‰¹é‡åŠ è½½embeddingå‘é‡
   - è¿æ¥æ± ç®¡ç†
   - å¼‚å¸¸å¤„ç†æœºåˆ¶

#### å¾…å®Œå–„é¡¹ç›®
- [ ] è¿æ¥æ± é…ç½®ä¼˜åŒ–
- [ ] ç¼“å­˜å‘½ä¸­ç‡ç›‘æ§
- [ ] çƒ­ç‚¹æ•°æ®é¢„åŠ è½½

### é˜¶æ®µ2: ç®—æ³•æ¶æ„ä¼˜åŒ– ğŸ”„

#### å¤šè·¯å¬å›æ¡†æ¶è®¾è®¡
```java
public class MultiRecallFramework {
    
    // 1. ååŒè¿‡æ»¤å¬å› (Enhanced)
    public List<Movie> collaborativeFiltering(User user, int candidateSize) {
        // ä½¿ç”¨æ”¹è¿›çš„çŸ©é˜µåˆ†è§£ç®—æ³•
        // è€ƒè™‘éšå¼åé¦ˆå’Œæ˜¾å¼è¯„åˆ†
        // å¼•å…¥æ—¶é—´è¡°å‡å› å­
    }
    
    // 2. æ·±åº¦å­¦ä¹ å¬å›
    public List<Movie> deepLearningRecall(User user, int candidateSize) {
        // åŒå¡”æ¨¡å‹: User Tower + Item Tower
        // åºåˆ—å»ºæ¨¡: RNN/Transformer
        // å¤šæ¨¡æ€ç‰¹å¾èåˆ
    }
    
    // 3. å›¾ç¥ç»ç½‘ç»œå¬å›
    public List<Movie> graphBasedRecall(User user, int candidateSize) {
        // æ„å»ºç”¨æˆ·-ç‰©å“å›¾
        // å›¾å·ç§¯ç½‘ç»œå­¦ä¹ embedding
        // éšæœºæ¸¸èµ°æŒ–æ˜é«˜é˜¶å…³ç³»
    }
    
    // 4. å¤šæ ·æ€§å¬å›
    public List<Movie> diversityRecall(User user, int candidateSize) {
        // DPP (Determinantal Point Process)
        // MMR (Maximal Marginal Relevance)
        // ç±»åˆ«è¦†ç›–åº¦ä¼˜åŒ–
    }
}
```

#### æ™ºèƒ½æ’åºç³»ç»Ÿè®¾è®¡
```java
public class IntelligentRankingSystem {
    
    // å¤šç›®æ ‡ä¼˜åŒ–æ’åº
    public double calculateMultiObjectiveScore(User user, Movie movie, Context context) {
        // å‡†ç¡®æ€§ç›®æ ‡
        double relevanceScore = predictRelevance(user, movie);
        
        // å¤šæ ·æ€§ç›®æ ‡  
        double diversityScore = calculateDiversity(movie, user.getRecentItems());
        
        // æ–°é¢–æ€§ç›®æ ‡
        double noveltyScore = calculateNovelty(movie, user.getProfile());
        
        // å•†ä¸šç›®æ ‡
        double businessScore = calculateBusinessValue(movie);
        
        // åŠ¨æ€æƒé‡è°ƒæ•´
        double[] weights = getAdaptiveWeights(user, context);
        
        return weights[0] * relevanceScore + 
               weights[1] * diversityScore + 
               weights[2] * noveltyScore + 
               weights[3] * businessScore;
    }
    
    // å®æ—¶ç‰¹å¾å·¥ç¨‹
    public FeatureVector extractFeatures(User user, Movie movie, Context context) {
        FeatureVector features = new FeatureVector();
        
        // ç”¨æˆ·ç‰¹å¾
        features.addUserFeatures(user.getAge(), user.getGender(), user.getPreferences());
        
        // ç‰©å“ç‰¹å¾
        features.addItemFeatures(movie.getGenres(), movie.getYear(), movie.getRating());
        
        // äº¤å‰ç‰¹å¾
        features.addCrossFeatures(calculateUserItemMatch(user, movie));
        
        // ä¸Šä¸‹æ–‡ç‰¹å¾
        features.addContextFeatures(context.getTime(), context.getDevice());
        
        return features;
    }
}
```

### é˜¶æ®µ3: é«˜çº§ä¼˜åŒ–ç­–ç•¥ ğŸ“ˆ

#### A/Bæµ‹è¯•æ¡†æ¶
```java
public class RecommendationExperiment {
    
    public List<Movie> getRecommendations(User user, ExperimentConfig config) {
        String group = assignExperimentGroup(user);
        
        switch(group) {
            case "baseline":
                return getBaselineRecommendations(user);
                
            case "multi_recall":
                return getMultiRecallRecommendations(user, config);
                
            case "deep_learning":
                return getDeepLearningRecommendations(user, config);
                
            case "multi_objective":
                return getMultiObjectiveRecommendations(user, config);
                
            default:
                return getBaselineRecommendations(user);
        }
    }
    
    // å®éªŒæ•ˆæœè¯„ä¼°
    public ExperimentResult evaluateExperiment(String experimentId) {
        return ExperimentResult.builder()
            .clickThroughRate(calculateCTR(experimentId))
            .userEngagement(calculateEngagement(experimentId))
            .diversity(calculateDiversity(experimentId))
            .novelty(calculateNovelty(experimentId))
            .businessMetrics(calculateBusinessMetrics(experimentId))
            .build();
    }
}
```

## ğŸ“ˆ æ€§èƒ½è¯„ä¼°ä½“ç³»

### ç¦»çº¿è¯„ä¼°æŒ‡æ ‡
```python
# å‡†ç¡®æ€§æŒ‡æ ‡
precision_at_k = true_positives / (true_positives + false_positives)
recall_at_k = true_positives / (true_positives + false_negatives)
f1_score = 2 * (precision * recall) / (precision + recall)

# æ’åºè´¨é‡æŒ‡æ ‡
ndcg = dcg / ideal_dcg
map_score = mean_average_precision(predictions, ground_truth)

# å¤šæ ·æ€§æŒ‡æ ‡
intra_list_diversity = average_pairwise_distance(recommended_items)
coverage = unique_recommended_items / total_items

# æ–°é¢–æ€§æŒ‡æ ‡
novelty = -log(popularity_of_recommended_items)
serendipity = unexpected_relevant_recommendations / total_recommendations
```

### åœ¨çº¿è¯„ä¼°æŒ‡æ ‡
```java
public class OnlineMetrics {
    
    // ç”¨æˆ·è¡Œä¸ºæŒ‡æ ‡
    public Metrics calculateUserMetrics() {
        return Metrics.builder()
            .clickThroughRate(clicks / impressions)
            .conversionRate(purchases / clicks)
            .userRetention(returning_users / total_users)
            .sessionDuration(average_session_time)
            .build();
    }
    
    // ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
    public SystemMetrics calculateSystemMetrics() {
        return SystemMetrics.builder()
            .responseTime(average_response_time)
            .throughputQPS(requests_per_second)
            .errorRate(errors / total_requests)
            .resourceUtilization(cpu_memory_usage)
            .build();
    }
}
```

## ğŸ› ï¸ å®æ–½è®¡åˆ’

### ç¬¬1å‘¨: åŸºç¡€ä¼˜åŒ–å®Œå–„
- [x] Redisç¼“å­˜ä¼˜åŒ– (å·²å®Œæˆ)
- [ ] æ‰¹é‡æ•°æ®åŠ è½½ä¼˜åŒ–
- [ ] æ€§èƒ½ç›‘æ§ç³»ç»Ÿæ­å»º
- [ ] åŸºå‡†æµ‹è¯•å»ºç«‹

### ç¬¬2-3å‘¨: å¤šè·¯å¬å›å®ç°
- [ ] ååŒè¿‡æ»¤ç®—æ³•å‡çº§
- [ ] å†…å®¹æ¨èç®—æ³•ä¼˜åŒ–
- [ ] çƒ­é—¨æ¨èæ—¶æ•ˆæ€§æ”¹è¿›
- [ ] å¤šè·¯å¬å›èåˆç­–ç•¥

### ç¬¬4-6å‘¨: æ’åºç³»ç»Ÿå‡çº§
- [ ] ç‰¹å¾å·¥ç¨‹æ¡†æ¶æ­å»º
- [ ] æœºå™¨å­¦ä¹ æ’åºæ¨¡å‹è®­ç»ƒ
- [ ] å¤šç›®æ ‡ä¼˜åŒ–å®ç°
- [ ] å®æ—¶æ’åºä¼˜åŒ–

### ç¬¬7-8å‘¨: é«˜çº§åŠŸèƒ½å¼€å‘
- [ ] A/Bæµ‹è¯•æ¡†æ¶å¼€å‘
- [ ] æ·±åº¦å­¦ä¹ æ¨¡å‹é›†æˆ
- [ ] å®æ—¶ä¸ªæ€§åŒ–æ¨è
- [ ] ç³»ç»Ÿæ€§èƒ½è°ƒä¼˜

## ğŸ“Š é¢„æœŸæ•ˆæœ

### æ€§èƒ½æå‡é¢„æœŸ
```
å¬å›é˜¶æ®µ:
- å¬å›å‡†ç¡®ç‡: 15-25% æå‡
- å¬å›å¤šæ ·æ€§: 30-40% æå‡
- å“åº”æ—¶é—´: ä¿æŒ < 100ms

æ’åºé˜¶æ®µ:
- æ’åºå‡†ç¡®æ€§: 20-30% æå‡  
- ç”¨æˆ·æ»¡æ„åº¦: 15-25% æå‡
- ç‚¹å‡»è½¬åŒ–ç‡: 10-20% æå‡

ç³»ç»Ÿæ•´ä½“:
- ååé‡: 2-3x æå‡
- èµ„æºåˆ©ç”¨ç‡: 20-30% ä¼˜åŒ–
- é”™è¯¯ç‡: < 0.1%
```

### ä¸šåŠ¡æŒ‡æ ‡é¢„æœŸ
- **ç”¨æˆ·ç•™å­˜ç‡**: æå‡15-20%
- **ç”¨æˆ·å‚ä¸åº¦**: æå‡25-35%
- **æ¨èç‚¹å‡»ç‡**: æå‡20-30%
- **ç”¨æˆ·æ»¡æ„åº¦**: æå‡15-25%

## ğŸ”§ æŠ€æœ¯é£é™©ä¸åº”å¯¹

### ä¸»è¦é£é™©
1. **ç®—æ³•å¤æ‚åº¦å¢åŠ **: å¯èƒ½å½±å“ç³»ç»Ÿå“åº”æ—¶é—´
2. **æ¨¡å‹è®­ç»ƒæˆæœ¬**: æ·±åº¦å­¦ä¹ æ¨¡å‹éœ€è¦å¤§é‡è®¡ç®—èµ„æº
3. **A/Bæµ‹è¯•é£é™©**: å¯èƒ½å½±å“éƒ¨åˆ†ç”¨æˆ·ä½“éªŒ
4. **æ•°æ®ä¸€è‡´æ€§**: å¤šè·¯å¬å›å¯èƒ½äº§ç”Ÿæ•°æ®ä¸ä¸€è‡´

### åº”å¯¹ç­–ç•¥
1. **åˆ†é˜¶æ®µå®æ–½**: é€æ­¥å‡çº§ï¼Œä¿è¯ç³»ç»Ÿç¨³å®šæ€§
2. **æ€§èƒ½ç›‘æ§**: å®æ—¶ç›‘æ§ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
3. **å›æ»šæœºåˆ¶**: å‡†å¤‡å¿«é€Ÿå›æ»šæ–¹æ¡ˆ
4. **å°æµé‡æµ‹è¯•**: å…ˆåœ¨å°ç”¨æˆ·ç¾¤ä½“æµ‹è¯•æ–°ç®—æ³•

## ğŸ“š å‚è€ƒèµ„æ–™

### å­¦æœ¯è®ºæ–‡
- Deep Learning for Recommender Systems (ACM Computing Surveys, 2019)
- Neural Collaborative Filtering (WWW 2017)
- Wide & Deep Learning for Recommender Systems (DLRS 2016)

### å·¥ç¨‹å®è·µ
- Alibabaæ¨èç³»ç»Ÿæ¶æ„æ¼”è¿›
- Netflixæ¨èç®—æ³•å®è·µ
- YouTubeæ¨èç³»ç»Ÿè®¾è®¡

### å¼€æºé¡¹ç›®
- [RecBole](https://github.com/RUCAIBox/RecBole) - æ¨èç³»ç»Ÿå·¥å…·åŒ…
- [TensorFlow Recommenders](https://github.com/tensorflow/recommenders) - TFæ¨èç³»ç»Ÿåº“
- [DeepCTR](https://github.com/shenweichen/DeepCTR) - æ·±åº¦å­¦ä¹ CTRé¢„ä¼°åº“

---

**å®éªŒè´Ÿè´£äºº**: æ¨èç³»ç»Ÿç ”ç©¶å›¢é˜Ÿ  
**å®éªŒæ—¥æœŸ**: 2025å¹´10æœˆ16æ—¥  
**ç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: è¿›è¡Œä¸­ ğŸ”„
